<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 5.4.4 (402282)"/><meta name="author" content="jennyzj"/><meta name="created" content="2014-05-26 07:56:50 +0000"/><meta name="updated" content="2014-05-26 07:58:00 +0000"/><title>高扩展 &amp; 高性能的 Hybrid 混合式开发</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);"><span style="-evernote-last-insertion-point:true;"/>关于 Hybrid 混合式开发，我们已经知道的很多了</p>
<ul style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;"><a href="http://www.atatech.org/articles/16729" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">《构建高可用移动web应用》</a>，by 元彦</li>
<li style="box-sizing: border-box;"><a href="http://www.atatech.org/articles/16731" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">《前后端分离的多终端适配》</a>，by 筱谷</li>
<li style="box-sizing: border-box;"><a href="http://www.atatech.org/articles/14228" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">《Hybrid 架构下的 H5 应用加速方案》</a>，by 石破</li>
</ul>
<h3 style="box-sizing: border-box; font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-weight: 500; line-height: 1.1; color: rgb(51, 51, 51); font-size: 24px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);">缘起</h3>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">通常我们认为将H5内嵌到Native中即是 Hybrid（混合式开发）。PhoneGap 给我们开了个好头，但好戏远没有结束，没错，PhoneGap （支付宝钱包和12306客户端的Hybrid均源于此）式的 Hybrid 尽管省去了先开浏览器再输入网址的麻烦事，但也带来的新的问题。</p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">我在2011年负责彩票前端 Team 的时候的 Hybrid 模式，是采用的完全内嵌 H5 到 Webview 的方式，我们重新设计实现了 <a href="https://speakerdeck.com/lijing00333/kissy-mobile-app-toolkit" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">Web 端的 App 框架</a>，在 browser 和 WebView 中保持统一的Native化的体验，同时用构建工具来保持 Web（online）<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 14px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); white-space: nowrap; border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px;">=&gt;</code>View（local） 的一致性，让开发阶段的内嵌成本降低，H5内嵌是是解决了（特别是弱网下）应用开启速度，但随着外接终端多起来（10多种）， 前端工程师为每个终端维护不同的分支代码，哪怕很小的 bugfix 和新版本更新都要修改所有分支，是在是低效的离谱。好在彩票的业务趋于稳定，所以，还好，能忍！～</p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);"><a href="http://gtms04.alicdn.com/tps/i4/T1T3LhFFBcXXbMa8rK-505-394.png" target="_blank" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;"><img src="%E9%AB%98%E6%89%A9%E5%B1%95%20&amp;%20%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%20Hybrid%20%E6%B7%B7%E5%90%88%E5%BC%8F%E5%BC%80%E5%8F%91.resources/f6a2c2e463c829e33909c02b0d2d2a46.png" height="394" width="505"/></a></p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">当2013年我开始带航旅前端 Team 时，航旅业务处于初创阶段，需求变化呈井喷状，这个阶段我们不得不暴力的以 URL 形式让航旅H5产品外接，比如下图是<a href="http://h5.m.taobao.com/trip/ticket/search/index.html" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">航旅门票H5</a>对接到多端，此外<a href="http://h5.m.taobao.com/trip/flight/search/index.html" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">机票H5</a>、<a href="http://h5.m.taobao.com/trip/hotel/search/index.html" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">酒店H5</a>等大量航旅产品都用同样方式外接。</p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);"><a href="http://gtms04.alicdn.com/tps/i4/T100kMFC8gXXXW9hzo-570-264.png" target="_blank" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;"><img src="%E9%AB%98%E6%89%A9%E5%B1%95%20&amp;%20%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%20Hybrid%20%E6%B7%B7%E5%90%88%E5%BC%8F%E5%BC%80%E5%8F%91.resources/613cb1a2e9f9df4878b71f52dde53c45.png" height="264" width="570"/></a></p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">在航旅业务高速发展、产品快速迭代阶段，Web 技术的特有优势被淋漓尽至的体现：</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">快速开发、快速发布</li>
<li style="box-sizing: border-box;">原型驱动、试错创新</li>
<li style="box-sizing: border-box;">外接迅速、拉取流量</li>
</ol>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">依靠这些优势，H5 自然可以捞到第一桶金，数据看起来漂亮极了</p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);"><a href="http://gtms04.alicdn.com/tps/i4/T1oH.fFxljXXcJuNYo-567-294.png" target="_blank" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;"><img src="%E9%AB%98%E6%89%A9%E5%B1%95%20&amp;%20%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%20Hybrid%20%E6%B7%B7%E5%90%88%E5%BC%8F%E5%BC%80%E5%8F%91.resources/62f2665fef3193cc8abae6848cf3c71b.png" height="294" width="567"/></a></p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">但，显然这仅仅把客户端当作 browser，尽管我们在前端框架瘦身、资源加载策略、图片压缩、menifest、localstorage方面穷尽所能的优化，Web 技术的基石所带来的瓶颈是无论如何也无法突破的，即：</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">所有资源必须通过网络加载（至少首次请求时全部资源都走网络）</li>
<li style="box-sizing: border-box;">HTTP 短链接的短板导致网络请求大把的时间没有用在刀刃上（传输资源）</li>
<li style="box-sizing: border-box;">网速越慢，加载速度的体验急剧下降</li>
</ol>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">Native 以 URL 内嵌 H5 不解决弱网下的体验问题，导致H5外接引流来的用户，无法留在客户端里。Hybrid 要解决的首要问题就是 H5内嵌Webview。但这时Hybrid已经有了更丰富的内涵：</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">Web 以 URL 定位资源的特征不应为 Hybrid 牺牲掉，Native 需要做更多事情来“预装”资源，以便在2G网路下为加载提速</li>
<li style="box-sizing: border-box;">Native 的缓存机制应当做到“透明”，即前端发布产品（给出一个URL），可同时被“内置”（local）到View、也可被“挂接”（URL）到View，以便尽可能灵活的适配多端</li>
</ol>
<h3 style="box-sizing: border-box; font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-weight: 500; line-height: 1.1; color: rgb(51, 51, 51); font-size: 24px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);">Hybrid 的半自动化</h3>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">按照这个思路，Native 缓存机制就成了自然的事情。@石破 在<a href="http://www.atatech.org/articles/14228" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">Hybrid 架构下的 H5 应用加速方案</a>中给出了“增量包”的概念，顺着这个线索往前推进了一大步。可以看到一个“透明”的Native缓存机制的雏形。有两点非常棒：</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">增量包Map的生成</li>
<li style="box-sizing: border-box;">H5调用Native API通过spdy来获取资源</li>
</ol>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">但依然有几个问题没有提及：</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">首次加载如何解决？</li>
<li style="box-sizing: border-box;">缓存JS/CSS/IMG资源很容易理解，Native 是否拦截 HTML 并缓存？
<ol style="box-sizing: border-box;">
<li style="box-sizing: border-box;">如果拦截并缓存，Web端有了新的发布，何时在 Native 端更新 HTML？</li>
<li style="box-sizing: border-box;">如果不拦截，Web 端的每次发布（<a href="http://velocity.alibaba-inc.com/projects/f2e-tools/wiki/Assets_Publish" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">Assets 生成新版本号</a>）都会带来全量的资源更新，增量包的意义被大大弱化（我们的TPS、Assets发布都基于Git走非覆盖式的了）</li>
</ol>
</li>
<li style="box-sizing: border-box;">2G 网络下也会强占用户带宽来拽取资源？</li>
<li style="box-sizing: border-box;">H5项目需要单独为Native View 的本地内嵌构建不同的代码，以便让Local化的H5去调用NativeAPI走spdy协议抓资源？</li>
</ol>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">三、四两点我们先放下，先看前两个问题：</p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">首先，首次加载提速只有“预装资源”才能解决，似乎没有第二种办法。</p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">再者，我们想知道 JS/CSS/IMG缓存 &amp; HTML 不缓存多大程度影响加载性能。</p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">基于这两点，我们将石破的“增量包”机制再向前推进一步：</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">用“预装包”来解决首次加载
<ol style="box-sizing: border-box;">
<li style="box-sizing: border-box;">具体做法是每次App发版之前先用脚本跑出来所有View中所需的资源，预先放到Native缓存空间里</li>
</ol>
</li>
<li style="box-sizing: border-box;">Native 强缓存
<ol style="box-sizing: border-box;">
<li style="box-sizing: border-box;">HTML 不做缓存，只用 View 中的 browser 内核来管理 HTML 的更新，一旦 HTML 有更新，所有资源走网络，一次过后强缓存到Native缓存池</li>
</ol>
</li>
</ol>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">通过实践，航旅客户端App所辖H5资源（五个类目产品）不超过4M，整个App安装包在15M左右，Assets 的预装 &amp; HTML 非缓存机制下，在2G中的提速是很明显的。我们在航旅客户端App 3.7 版本采用这种策略，QA团队也给出了H5性能数据报告，2G网络下提速不是一点点（<a href="http://gtms04.alicdn.com/tps/i4/T1sUPUFT0bXXanuoU8-1234-610.png" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">IOS结果</a>，<a href="http://gtms01.alicdn.com/tps/i1/T1_6HZFF0aXXXQomfa-1236-644.png" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">Android结果</a>）</p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);"><a href="http://gtms03.alicdn.com/tps/i3/T1ECj4FGxcXXchqHLy-604-313.png" target="_blank" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;"><img src="%E9%AB%98%E6%89%A9%E5%B1%95%20&amp;%20%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%20Hybrid%20%E6%B7%B7%E5%90%88%E5%BC%8F%E5%BC%80%E5%8F%91.resources/56bd2004a6b797b7442437b32607160c.png" height="313" width="604"/></a></p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">结合上面的三、四两点和这次优化的经验，现在 Hybrid 混合式编程面临的问题被聚焦在了这三方面：</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">预装包的思路是正确的，但为了保持预装资源有效，必须控制前端 Assets 资源的版本发布，这样H5的快速迭代快速上线的优势将收到制约</li>
<li style="box-sizing: border-box;">由于HTML没有做缓存，所以和Native相比，还是存在3-4秒的菊花和白屏</li>
<li style="box-sizing: border-box;">App资源更新缺乏有效的机制管理，在2G/3G下也会因为资源更新而独占流量</li>
</ol>
<h3 style="box-sizing: border-box; font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-weight: 500; line-height: 1.1; color: rgb(51, 51, 51); font-size: 24px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);">回到最原始的问题，求解思路渐渐清晰</h3>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">让我们回过头来，看下 Hybrid 要解决的根本问题，本质上是集成H5和Native的优势，抵消两者劣势</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">H5 的角色是承载流量和内容，优势是开发部署迅速，缺点是加载性能</li>
<li style="box-sizing: border-box;">Native 的角色是做差异化服务，优势是速度快，动态更新是其短板</li>
</ol>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">所以，再来看上面提到需要聚焦解决的三个问题，Web 产品的发布不应当被 Hybrid 限制，HTML 也应当被强缓存或者“预装”，禁止占用2G网络用户的带宽来更新资源。这样就必须要求H5端做到：</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">H5项目代码需要支持本地化和URL访问两种形式（需要前端搞定HTML local化后 MTOP 数据抓取问题，<a href="http://work.taobao.net/issues/11623#note-16" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">方案很多</a>）</li>
<li style="box-sizing: border-box;">H5项目代码资源体积必须要做控制，防止对客户端安装包大小带来负面影响（我们推动了<a href="http://m.kissyui.com/" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">KISSY MINI</a>的落地，基础库体积基本上有了保障）</li>
<li style="box-sizing: border-box;">前端代码部署从人肉走向自动化（航旅有<a href="http://cnpmjs.org/package/generator-clam" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">比较完善的部署工具</a>）</li>
</ol>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">而Native端必须在这些方面和H5衔接：</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">预装包和强缓存（这次3.7的优化已经做了）方案保留</li>
<li style="box-sizing: border-box;">本地资源以版本形式存放在App缓存池中，H5永远首先取缓存</li>
<li style="box-sizing: border-box;">H5代码的更新通过“Diff控制器”和“资源加载器”在后台进程完成（更简单的“增量包”机制）</li>
<li style="box-sizing: border-box;">更新资源是一个很“重”的操作，需要在强网环境下完成，强弱网由客户端判断</li>
<li style="box-sizing: border-box;">客户端每次开启都访问配置文件，配置文件体积小访问速度快，存放各个H5项目的版本信息</li>
</ol>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">万事具备了？</p>
<h3 style="box-sizing: border-box; font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-weight: 500; line-height: 1.1; color: rgb(51, 51, 51); font-size: 24px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);">高可扩展 &amp; 高性能的 Hybrid 方案</h3>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">从最初的需求、到求解的过程、再到绞尽脑汁的各种方案尝试，我们可以比较清楚的看清我们想要的 Hybrid 混合式编程架构。在上面结论的基础上，增加缓存池中H5资源的“版本”概念，版本更新交由Native管理员（由运营同学负责）和资源加载器（Assets Loader）来控制。</p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">对于开发者来说：</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">H5 产品开发发布该怎么发布还怎么发布</li>
<li style="box-sizing: border-box;">除了<a href="http://g.alicdn.com/mpi/bridge/docs/index.html" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;">桥协议</a>，前端工程师无需对Native过多关注，让Native对Web开发更透明</li>
<li style="box-sizing: border-box;">接到一个H5外接的新需求，将 URL 扔给 PD 即可</li>
</ol>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">对于用户来说：</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">H5 资源“比较及时”的更新到用户端</li>
<li style="box-sizing: border-box;">2G下流畅的完成操作（比如购买机票），无需在意会有版本更新来抢占2G带宽</li>
</ol>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);"><a href="http://gtms04.alicdn.com/tps/i4/T1hCEtFpdlXXXZusMW-867-528.png" target="_blank" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;"><img src="%E9%AB%98%E6%89%A9%E5%B1%95%20&amp;%20%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%20Hybrid%20%E6%B7%B7%E5%90%88%E5%BC%8F%E5%BC%80%E5%8F%91.resources/a40ba3b9afb4dce5a28d1237da025f36.png" height="528" width="867"/></a></p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">这个方案已经开始在航旅客户端4.0版本中落地，期待这个方案为前端开发带来更多红利。</p>
<h3 style="box-sizing: border-box; font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-weight: 500; line-height: 1.1; color: rgb(51, 51, 51); font-size: 24px; border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(221, 221, 221); background-color: rgb(255, 255, 255);">不得不做的妥协？</h3>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">“比较及时”的更新？天哪，对于那些实时性要求很高的H5有无解？要回答这个问题，我们首先要看清业务特征，再来回答，航旅App非常适合上面提到的 Hybrid 架构，是因为航旅的产品更加“工具化”和“App化”，即H5承载的是购票工具所需的功能，而新品推荐、流量二跳、大促和拉新不是我们的主流业务类型，用户在旅行途中往往只有2G网络伴随左右，所以弱网下能不能帮助用户比较流畅的完成购买操作，要比“逛呀逛找新产品”的需求重要的多、关键的多。所以这里的“比较及时”的推送H5新功能是ok的。</p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">我们可以对比下去哪儿客户端和手机淘宝App，在2G网络下去哪儿App在2G下干脆吧运营位用一张图覆盖了，手淘App直接让H5外接的模块不可用，这也是那些实时性要求高的web页面在2G下的一种归宿</p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);"><a href="http://gtms01.alicdn.com/tps/i1/T1KGDWFQFbXXXbebgo-424-326.png" target="_blank" style="box-sizing: border-box; background-color: transparent; color: rgb(66, 139, 202); text-decoration: none; background-position: initial initial; background-repeat: initial initial;"><img src="%E9%AB%98%E6%89%A9%E5%B1%95%20&amp;%20%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%20Hybrid%20%E6%B7%B7%E5%90%88%E5%BC%8F%E5%BC%80%E5%8F%91.resources/77c31c56b742b0c311497c56b4e670fa.png" height="326" width="424"/></a></p>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">因此我们可以这样来回答“比较及时”的更新的问题：强弱网的差异化设计</p>
<ol style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">
<li style="box-sizing: border-box;">在弱网（2G/3G）下作为工具，App 提供基本的交易、购买、下单流程（ 可用 ）</li>
<li style="box-sizing: border-box;">在强网（WIFI）下作为内容容器，App 提供更丰富的内容推荐和运营（ 可逛 ）</li>
</ol>
<p style="box-sizing: border-box; letter-spacing: 0.03rem; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; line-height: 27.200000762939453px; background-color: rgb(255, 255, 255);">从产品设计的源头考虑强弱网环境下用户的差异化需求，这样，我们的 Hybrid 混合式编程才能更精准的找到自己的战场，说的更直接一些，弱网就像残障用户在用我们的产品，是需要我们做一些“无障碍”的降级方案的，只不过 Mobile 领域中残障用户数量比PC端庞大的多。</p>
<span style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif; font-size: 16px; letter-spacing: 0.03rem; line-height: 27.200000762939453px;">航旅会义无反顾的坚持这种高扩展的 Hybrid 编程架构，方案也是在不断进化的，也欢迎大家参与设计和讨论～</span>

<div>
TIP: 为什么不用HTML5标准的AppCache？两个原因，1，Assets的缓存好做，但 HTML 本身的更新需要外围一套策略来保障，成本和上面所说Native Hybrid差不多。2，IOS7下manifest众所周知的大bug</div>
</body></html>